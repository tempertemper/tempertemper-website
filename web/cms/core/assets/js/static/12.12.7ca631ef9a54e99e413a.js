webpackJsonp([12],{53:function(a,t){a.exports=function(){var a,t=function(t){a=t,a(".blocks").length&&(e(),r(),a(".block-wrap").attr("data-init",!0),i(),n(),o())},e=function(){a(".blocks").each(function(t,e){var n=a(e),i=n.find(".master.block-add-bar");n.find(".block-wrap:not([data-init])").each(function(t,e){var n=a(e),r=i.clone();r.removeClass("master").removeClass("hidden");var o=n.attr("data-block");r.find("a").each(function(t,e){var n=a(e),i=n.attr("href");n.attr("href",i+"&after="+o)}),r.appendTo(n)});var r=n.find(".block-wrap").length;r>0&&i.addClass("hidden"),n.attr("data-next-index",r)})},n=function(){a(".blocks").on("click",".block-add-bar a",function(t){t.preventDefault();var e=a(t.target);e.is(".block-add-bar a")||(e=e.parents("a"));var n=e.parents(".block-wrap"),i=n.parent(".blocks").attr("data-next-index"),r=e.attr("href");r+="&count="+i;var o=r.split("?");a.ajax(o[0],{type:"POST",data:o[1],success:function(t){n.parent(".blocks").attr("data-next-index",parseInt(i)+1),n.length?(n.after(t),n.next(".block-wrap").hide().css("visibility","hidden").slideDown("fast",function(){a(this).hide().css("visibility","").fadeIn("fast")})):e.parents(".blocks").append(t);var r=a(t);a("input[name='_blocks_deleted[]']").each(function(t,e){var n=a(e);n.val()==r.attr("data-prefix")&&n.remove()}),a(window).trigger("Perch_Init_Editors").trigger("Perch_Init_Editors_Post")}})})},i=function(){a("form").on("submit",function(){a(this).find(".block-wrap").each(function(t,e){var n=a(e),i=n.find("input.index");i.val(t)})})},r=function(){a(".block-wrap:not([data-init]) .divider .rm").each(function(t,e){var n=a(e),i=a('<a href="#">'+Perch.UI.Helpers.icon("core/cancel")+'<span aria-hidden="true">'+Perch.Lang.get("Delete this item?")+"</span></a>");i.appendTo(n)}),a(".block-wrap:not([data-init])").on("click",".divider .rm a",function(t){t.preventDefault();var e=a(this),n=e.parents(".block-wrap");n.after(a('<input type="hidden" name="_blocks_deleted[]" value="'+n.attr("data-prefix")+'" />'));var i=e.parents(".blocks");1==i.find(".block-wrap").length&&i.find(".master.block-add-bar").hide().removeClass("hidden").fadeIn("fast"),n.selfHealingRemove({speed:"fast"})})},o=function(){Perch.UI.Sortables.makeSortable(".blocks",{items:"> .block-wrap",handle:".divider",axis:"y"})},c=function(t){a(t).on("Perch_Init_Editors",function(){e(),r(),a(".block-wrap").attr("data-init",!0)})};return{init:t,reinit:e,registerEvents:c}}()}});